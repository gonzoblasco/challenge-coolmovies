query AllMovies {
  allMovies {
    nodes {
      id
      title
      releaseDate
      imgUrl
      movieReviewsByMovieId {
        nodes {
          id
          title
          body
          rating
          userReviewerId
          userByUserReviewerId {
            name
          }
        }
      }
    }
  }
}

mutation CreateReview(
  $title: String!
  $body: String!
  $rating: Int!
  $movieId: UUID!
  $userId: UUID!
) {
  createMovieReview(
    input: {
      movieReview: {
        title: $title
        body: $body
        rating: $rating
        movieId: $movieId
        userReviewerId: $userId
      }
    }
  ) {
    movieReview {
      id
      title
      body
      rating
      movieId
      userByUserReviewerId {
        name
      }
    }
  }
}

mutation UpdateReview($id: UUID!, $patch: MovieReviewPatch!) {
  updateMovieReviewById(input: { id: $id, movieReviewPatch: $patch }) {
    movieReview {
      id
      title
      body
      rating
    }
  }
}

query MovieReviews($id: UUID!, $filter: MovieReviewFilter) {
  movieById(id: $id) {
    id
    title
    movieReviewsByMovieId(filter: $filter, orderBy: [PRIMARY_KEY_DESC]) {
      nodes {
        id
        title
        body
        rating
        userReviewerId

        userByUserReviewerId {
          name
        }
        commentsByMovieReviewId(orderBy: [PRIMARY_KEY_ASC]) {
          nodes {
            id
            title
            body
            userId
            userByUserId {
              id
              name
            }
          }
        }
      }
    }
  }
}

query AllUsers {
  allUsers {
    nodes {
      id
      name
    }
  }
}

mutation CreateComment(
  $title: String
  $body: String!
  $reviewId: UUID!
  $userId: UUID!
) {
  createComment(
    input: {
      comment: {
        title: $title
        body: $body
        movieReviewId: $reviewId
        userId: $userId
      }
    }
  ) {
    comment {
      id
      title
      body
      movieReviewId
      userByUserId {
        id
        name
      }
    }
  }
}

fragment NewComment on Comment {
  id
  title
  body
  userByUserId {
    id
    name
  }
}

mutation DeleteComment($id: UUID!) {
  deleteCommentById(input: { id: $id }) {
    comment {
      id
      movieReviewId
    }
  }
}

mutation DeleteReview($id: UUID!) {
  deleteMovieReviewById(input: { id: $id }) {
    movieReview {
      id
      movieId
    }
  }
}
